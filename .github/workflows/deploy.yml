name: VDS Deploy
# Sadece master branchine pushlanÄ±nca deploy edilsin
on:
    push:
        branches:
            - master
# Yapilacak islemler
jobs:
    deploy:
        runs-on: ubuntu-22.04 # Kodlarin calismasi icin gereken isletim sistemi

        steps:
            - name: Deploy using SSH
              uses: appleboy/ssh-action@v1.0.3
              with:
                  # SSH baglantisi icin gereken bilgiler Github repo secretlerden geliyor
                  host: ${{ secrets.DEPLOY_SERVER_HOST }} # Serverin IP adresi
                  username: ${{ secrets.DEPLOY_SERVER_USER }} # Serverin kullanici adi
                  key: ${{ secrets.SSH_PRIVATE_KEY }} # Servere giris icin kullanilan private key
                  script: |
                      echo "ðŸš€ Starting deployment..."

                      cd /home/hfk/backend/final-proje/server 

                      echo "âœ… Navigated to project directory"

                      echo " pulling latest changes..."

                      git pull origin master

                      echo "âœ… Code updated"

                      echo "ðŸ“¦ Installing/updating dependencies..."

                      npm install

                      echo "âœ… Dependencies installed"

                      echo "ðŸ”„ Reloading PM2 application..."

                      pm2 reload my-api

                      echo "âœ… PM2 application reloaded"

                      echo "ðŸŽ‰ Deployment finished!"
